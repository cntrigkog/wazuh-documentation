.. _vulnerability-detector:

Vulnerability detector
=======================

.. versionadded:: 3.2.0

This Wazuh module allows you to schedule periodic detection of vulnerabilities in agents and managers, making the task of protect hosts easy.

- `What it is Vulnerability detector?`_
- `How it works?`_
- `How to configure`_
- `Use case`_
- `Compatibility matrix`_


What it is Vulnerability detector?
-----------------------------------

Vulnerability detector is a wodle created to automate vulnerability detection on servers with Wazuh deployed, without having to install any external dependencies.

How it works?
--------------

Syscollector wodle collects information about all agent software and sends it to the manager, which indexes it in Wazuh-DB. At this time, Vulnerability detector wodle can compare agent software information with your vulnerability databases.

Vulnerability databases are updated according to the time interval configured for each repository. In this process, it will be checked if the official repositories of each distribution have updated their information, to refresh or not our local database installed in the manager.

The vulnerability detection process will also run under its own interval time. To do this, Vulnerability detector will consult the list of updated software of each agent to compare it with vulnerability databases, triggering alerts in case of finding vulnerables packages or programs.


How to configure
-----------------

First, you must enable the software collection activating the parameter ``programs`` in the **Syscollector** :doc:`configuration<../reference/ossec-conf/wodle-syscollector>` of the agents and managers that you want to analyze.

.. code-block:: xml

    <wodle name="syscollector">
      <disabled>no</disabled>
      <interval>1h</interval>
      <scan_on_start>yes</scan_on_start>
      <programs>yes</programs>
    </wodle>

After this, you need to activate **Vulnerability detector** in the manager following its :doc:`configuration guide<../reference/ossec-conf/wodle-vuln-detector>`.

Compatibility matrix
---------------------

The following table shows the operating systems that agents/managers must have to be compatible with Vulnerability detector. It will be increased in future versions.

+---------+-------------+
| Distro  | Versions    |
+=========+=============+
| Redhat  | 5, 6, 7     |
+---------+-------------+
| Centos  | 5, 6, 7     |
+---------+-------------+
| Ubuntu  | 12, 14, 16  |
+---------+-------------+

Use case
----------

The next case of use configures vulnerability detection with a periodicity of 1 day. In addition, it will update RedHat 7/6 databases every 15h and Ubuntu 16/14 databases every 10h.

.. code-block:: xml

    <wodle name="vulnerability-detector">
      <disabled>no</disabled>
      <interval>1d</interval>
      <run_on_start>yes</run_on_start>
      <update_ubuntu_oval interval="10h" version="16,14">yes</update_ubuntu_oval>
      <update_redhat_oval interval="15h" version="7,6">yes</update_redhat_oval>
    </wodle>

Alert examples
---------------

.. code-block:: console
   :emphasize-lines: 3

   ** Alert 1518102634.606548: - vulnerability-detector,
    2018 Feb 08 16:10:34 (hostserver) ->vulnerability-detector
    Rule: 23503 (level 5) -> 'CVE-2017-18027 on Ubuntu 16.04 LTS (xenial) - low.'
    vulnerability.cve: CVE-2017-18027
    vulnerability.title: CVE-2017-18027 on Ubuntu 16.04 LTS (xenial) - low.
    vulnerability.severity: Low
    vulnerability.published: 2018-01-12
    vulnerability.updated: 2018-01-12
    vulnerability.reference: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2017-18027
    vulnerability.rationale: In ImageMagick 7.0.7-1 Q16, a memory leak vulnerability was found in the function ReadMATImage in coders/mat.c, which allow remote attackers to cause a denial of service via a crafted file.
    vulnerability.state: Pending confirmation
    vulnerability.affected_package: imagemagick
    vulnerability.version: 8:6.8.9.9-7ubuntu5.9

.. code-block:: console
   :emphasize-lines: 3

    ** Alert 1518102634.152105: - vulnerability-detector,
    2018 Feb 08 16:10:34 (webserver) ->vulnerability-detector
    Rule: 23504 (level 7) -> 'CVE-2016-4491 on Ubuntu 14.04 LTS (trusty) - medium.'
    vulnerability.cve: CVE-2016-4491
    vulnerability.title: CVE-2016-4491 on Ubuntu 16.04 LTS (trusty) - medium.
    vulnerability.severity: Medium
    vulnerability.published: 2017-02-24
    vulnerability.updated: 2017-02-24
    vulnerability.reference: https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2016-4491
    vulnerability.rationale: The d_print_comp function in cp-demangle.c in libiberty allows remote attackers to cause a denial of service (segmentation fault and crash) via a crafted binary, which triggers infinite recursion and a buffer overflow, related to a node having "itself as ancestor more than once."
    vulnerability.state: Pending confirmation
    vulnerability.affected_package: gdb
    vulnerability.version: 7.11.1-0ubuntu1~14.4
